import subprocess

def shell(command, cwd=None):
    return subprocess.check_output(command, shell=True, cwd=cwd).decode('utf-8').strip()

class FilterModule(object):
    def filters(self):
        return {
            'shell': shell
        }



=====

<html>
<head>
  <title>User Account Audit Report</title>
</head>
<body>
  <h1>User Account Audit Report</h1>
  <table>
    <tr>
      <th>User account</th>
      <th>Groups user is member of</th>
      <th>Last login</th>
      <th>Password expiry</th>
      <th>Last password change</th>
    </tr>
    {% for user in user_list.stdout_lines %}
    <tr>
      <td>{{ user }}</td>
      <td>{{ user | shell('groups') }}</td>
      <td>{{ user | shell('lastlog -u ' + user + ' | tail -n 1 | cut -c 44-', '/etc') }}</td>
      <td>{{ user | shell('chage -l ' + user + " | awk -F ': ' '/^Password expires/ { print $2 }'", '/etc') }}</td>
      <td>{{ user | shell('chage -l ' + user + " | awk -F ': ' '/^Last password change/ { print $2 }'", '/etc') }}</td>
    </tr>
    {% endfor %}
  </table>
</body>
</html>



======
