<html>
<head>
  <title>User Account Audit Report</title>
</head>
<body>
  <h1>User Account Audit Report</h1>
  <table>
    <tr>
      <th>User account</th>
      <th>Groups user is member of</th>
      <th>Last login</th>
      <th>Password expiry</th>
      <th>Last password change</th>
    </tr>
    {% for user in user_list.stdout_lines %}
    <tr>
      <td>{{ user }}</td>
      <td>{{ user | shell('id -Gn ' + user) }}</td>
      <td>{{ user | shell('lastlog -u ' + user + ' |tail -n 1 | cut -c 44-') }}</td>
      <td>{{ user | shell('chage -l ' + user + " | grep 'Password expires' | cut -d ':' -f 2") }}</td>
      <td>{{ user | shell('chage -l ' + user + " | grep 'Last password change' | cut -d ':' -f 2") }}</td>
    </tr>
    {% endfor %}
  </table>
</body>
</html>
