resource "azurerm_windows_web_app" "app" {
  name                = "my-win-container-app"
  resource_group_name = azurerm_resource_group.rg.name
  location            = azurerm_resource_group.rg.location
  service_plan_id     = azurerm_service_plan.asp.id

  site_config {
    windows_fx_version = format(
      "DOCKER|%s/%s/%s:%s",
      var.jfrog_server,
      var.jfrog_repo,
      var.image_name,
      var.image_tag
    )
  }

  app_settings = {
    "DOCKER_REGISTRY_SERVER_URL"      = "https://${var.jfrog_server}"
    "DOCKER_REGISTRY_SERVER_USERNAME" = var.jfrog_username
    "DOCKER_REGISTRY_SERVER_PASSWORD" = var.jfrog_password
  }

  lifecycle {
    ignore_changes = [
      site_config[0].windows_fx_version
    ]
  }
}
